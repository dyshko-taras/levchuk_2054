# âš™ï¸ Project Guidelines â€” Flutter App (Global)

This is a **cross-project** coding guide. It defines structure, style, and contracts for tokens/assets.

> **Normative precedence**
>
> 1. **PRD** (per-project)
> 2. **Implementation Plan** (per-project)
> 3. **This Global Guide**
>    If any conflict exists â†’ **PRD wins**. Do **not** infer domain models, screens, or routes for a specific app from generic examples below.

---

## ğŸ“¦ Project Structure (lib/)

```
lib/
â”œâ”€â”€ app.dart                      # App root: MaterialApp, theme setup, top-level providers
â”œâ”€â”€ main.dart                     # Entry point: runApp(), platform/bootstrap init
â”‚
â”œâ”€â”€ core/                         # Cross-cutting concerns
â”‚   â”œâ”€â”€ endpoints.dart            # Base URLs and API route paths
â”‚   â””â”€â”€ env.dart                  # Environment flags (dev/prod) and runtime switches
â”‚
â”œâ”€â”€ constants/                    # Design tokens & asset constants (see â€œConstants contractâ€)
â”‚   â”œâ”€â”€ app_config.dart
â”‚   â”œâ”€â”€ app_icons.dart
â”‚   â”œâ”€â”€ app_images.dart
â”‚   â”œâ”€â”€ app_routes.dart
â”‚   â”œâ”€â”€ app_strings.dart
â”‚   â”œâ”€â”€ app_radius.dart
â”‚   â”œâ”€â”€ app_sizes.dart
â”‚   â”œâ”€â”€ app_durations.dart
â”‚   â””â”€â”€ app_spacing.dart
â”‚
â”œâ”€â”€ utils/                        # Common utilities (formatters, validators, etc.)
â”‚
â”œâ”€â”€ data/                         # Data layer (API, DB, repositories)
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ api_client.dart          # Dio client
â”‚   â”‚   â”œâ”€â”€ <feature>_service.dart   # Retrofit service interfaces
â”‚   â”‚   â””â”€â”€ <feature>_service.g.dart # generated by retrofit
â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”œâ”€â”€ memory_cache.dart
â”‚   â”‚   â”œâ”€â”€ prefs_store.dart
â”‚   â”‚   â””â”€â”€ database/
â”‚   â”‚       â”œâ”€â”€ app_database.dart
â”‚   â”‚       â”œâ”€â”€ schema/          # table/entity definitions
â”‚   â”‚       â””â”€â”€ dao/             # typed queries
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ <feature>.dart           # json_serializable model
â”‚   â”‚   â””â”€â”€ <feature>.g.dart         # generated by json_serializable
â”‚   â””â”€â”€ repositories/
â”‚       â””â”€â”€ <feature>_repository.dart
â”‚
â”œâ”€â”€ enums/
â”‚   â””â”€â”€ enums.dart
â”‚
â”œâ”€â”€ providers/                    # Business logic (ChangeNotifier)
â”‚   â””â”€â”€ <feature>_provider.dart
â”‚
â””â”€â”€ ui/
    â”œâ”€â”€ theme/                    # Color, fonts, ThemeData
    â”‚   â”œâ”€â”€ app_fonts.dart
    â”‚   â”œâ”€â”€ app_colors.dart
    â”‚   â””â”€â”€ app_theme.dart
    â”œâ”€â”€ pages/                    # Screens
    â”‚   â”œâ”€â”€ home_page.dart
    â””â”€â”€ widgets/                  # Reusable UI
        â”œâ”€â”€ common/
        â”œâ”€â”€ buttons/
        â”œâ”€â”€ dialogs/
        â”œâ”€â”€ fields/
        â””â”€â”€ navigation/
```

> **LLM rule:** Filenames with `<feature>` are **generic examples**. Use app-specific names only if they are defined in the **PRD**.

---

## ğŸ§  State Management

- Primary approach: **Provider** (+ `ChangeNotifier`) in `lib/providers/`.
- Business logic lives in providers; widgets are dumb (display/interaction only).

### Granularity Rules
- **Providers are feature/domainâ€“scoped, not page-scoped.**  
    Example: `UserProvider` handles all user-related state and can be used across multiple screens (`UserListPage`, `UserDetailsPage`).
- Do **not** create one provider per screen if they belong to the same domain â€” this causes duplicated logic and inconsistent state.
- Multiple pages can consume the same provider instance if they share business logic.
- Providers expose only domain-specific state and actions; they should not depend on UI details.

## ğŸŒ Networking

*Networking layer uses `Dio` + `Retrofit` + `json_serializable`.*

### Structure

* **`data/api/api_client.dart`** â€” base Dio client (baseUrl, timeouts, interceptors).
* **`data/api/<feature>_service.dart`** â€” Retrofit interface (`@GET`, `@POST`, etc.).
* **`data/models/<feature>.dart`** â€” model annotated with `@JsonSerializable()`.
* **`data/repositories/<feature>_repository.dart`** â€” encapsulates API access.
* **`providers/<feature>_provider.dart`** â€” manages state and calls repository.

### Example

**api\_client.dart**

```dart
import 'package:dio/dio.dart';
import '../../core/endpoints.dart';

class ApiClient {
  static final Dio dio = Dio(
    BaseOptions(
      baseUrl: Endpoints.baseUrl,
      connectTimeout: const Duration(seconds: 10),
      receiveTimeout: const Duration(seconds: 10),
      headers: {'Content-Type': 'application/json'},
    ),
  );

  static void addInterceptors() {
    dio.interceptors.add(LogInterceptor(responseBody: true));
  }
}
```

**user\_service.dart**

```dart
import 'package:retrofit/retrofit.dart';
import 'package:dio/dio.dart';
import '../models/user.dart';
import 'api_client.dart';

part 'user_service.g.dart';

@RestApi()
abstract class UserService {
  factory UserService(Dio dio, {String baseUrl}) = _UserService;

  @GET('/users')
  Future<List<User>> getUsers();

  @GET('/users/{id}')
  Future<User> getUser(@Path("id") int id);
}

UserService createUserService() =>
    UserService(ApiClient.dio, baseUrl: ApiClient.dio.options.baseUrl);
```

**user.dart**

```dart
import 'package:json_annotation/json_annotation.dart';

part 'user.g.dart';

@JsonSerializable()
class User {
  final int id;
  final String name;
  final String email;

  User({required this.id, required this.name, required this.email});

  factory User.fromJson(Map<String, dynamic> json) =>
      _$UserFromJson(json);
  Map<String, dynamic> toJson() => _$UserToJson(this);
}
```

---

## âœ… Restrictions (LLM Guardrails)

* Use **only `json_serializable`** for data models.
* Retrofit services must be **generated with `build_runner`**, not handwritten.
* All HTTP requests must go through **Dio** (via Retrofit).
* Repositories abstract API services, Providers manage state.
* Never call Dio directly from UI or Provider.

---

## ğŸ§­ Navigation (`app_routes.dart`)

1. Centralize all route names in `constants/app_routes.dart`.
2. Use `initialRoute` + `routes`.
3. Root navigation uses **MainShellPage + BottomNavProvider + IndexedStack**.
4. Use `MainShellPage` **only when the app includes a Bottom Navigation bar** â€” it serves as the shared shell for switching between tab routes.
5. Register each **tab route** (e.g. `/home`, `/schedule`, `/stats`, `/settings`) to return the **same** `MainShellPage` with different `initialIndex`.
6. Do **not** register tab pages themselves as top-level routes.
7. Deep links: navigating to a tab route should show `MainShellPage` with the correct index.
8. Non-tab detail pages (e.g., item details, forms) can be registered as standard routes in `AppRoutes.routes` outside of the shell.

Example code
```dart
// constants/app_routes.dart
import 'package:flutter/material.dart';
import '../ui/pages/main_shell_page.dart';

class AppRoutes {
  // Pages
  static const String welcome = '/welcome';

  // Shell
  static const String main = '/main';

  // Tab routes
  static const String home = '/home';
  static const String schedule = '/schedule';
  static const String stats = '/stats';

  static Map<String, WidgetBuilder> routes = {
    welcome: (_) => const WelcomePage(),
    home:(_) => const MainShellPage(initialIndex: 0),
    schedule:(_) => const MainShellPage(initialIndex: 1),
    stats:(_) => const MainShellPage(initialIndex: 2),
  };
}
```

---

## ğŸ¨ Theme (`app_theme.dart`)

* **Material 3** (`useMaterial3: true`), single theme (no light/dark unless PRD says otherwise).
* Define `ColorScheme` (recommended: `ColorScheme.fromSeed`) and bind typography via `TextTheme`.
* Keep component themes here (`AppBarTheme`, `CardTheme`, inputs, buttons, etc.).
* Use colors from `app_colors.dart`, fonts from `app_fonts.dart`.

```dart
// ui/theme/app_theme.dart (sketch)
final ThemeData appTheme = ThemeData(
  useMaterial3: true,
  colorScheme: ColorScheme.fromSeed(seedColor: const Color(0xFFA77CFF), brightness: Brightness.dark),
  textTheme: TextTheme(
    titleLarge: const TextStyle(fontSize: 20, fontWeight: FontWeight.w600),
    bodyMedium: const TextStyle(fontSize: 14),
  ),
);
```

---

## ğŸ“š Constants (Tokens & Assets) â€” **Contract for LLM**

**Purpose.** These files are the **single source of truth** for design tokens and asset paths.
**Never** hardcode numbers for spacing/radius/durations, and **never** use raw `'assets/...'` strings in widgets.

### Assets

* `lib/constants/app_icons.dart` â€” SVG icons.
  *Use:* `SvgPicture.asset(AppIcons.home)`
* `lib/constants/app_images.dart` â€” raster/photos & helpers
  *Use:* `Image.asset(AppImages.welcomeHero)`

**Rules**

* Do **not** write raw paths like `'assets/icons/home.svg'`.
* Use only `AppIcons.*` and `AppImages.*`.

### Design Tokens

* `app_spacing.dart` â€” spacing helpers: `AppSpacing` (xs/sm/md/â€¦), `Gaps` (ready `SizedBox`), `Insets` (EdgeInsets), `NumSpaceExtension` (`12.h`, `8.w`).
* `app_sizes.dart` â€” component sizes (e.g., `Sizes.donutSize`).
* `app_radius.dart` â€” `BorderRadius` tokens (`AppRadius.sm/md/lg/xl/pill`).
* `app_durations.dart` â€” UX timings (e.g., `AppDurations.splashMin`, animations).

**Examples**

```dart
// Spacing (no magic numbers)
Padding(padding: Insets.allMd, child: Column(children: [Gaps.hSm, 16.h]));

// Sizes + Radius
Container(height: Sizes.donutSize, decoration: const BoxDecoration(borderRadius: AppRadius.lg));

// Duration
await Future.delayed(AppDurations.splashMin);

// Assets
SvgPicture.asset(AppIcons.settings);
Image.asset(AppImages.welcomeHero);
```

> **LLM rules (strict):**
> â€¢ Do **not** invent new token/asset files. Use **only** the files above.
> â€¢ If an example here conflicts with PRD/Implementation Plan â†’ **follow PRD**.
> â€¢ Do **not** inline raw numbers for spacing/radius/durations.

---

## ğŸ”¤ Strings (`app_strings.dart`)

- Central source for **all static UI text** (titles, buttons, hints, messages).
- **Never hardcode strings** â€” always use `AppStrings`.
- Group keys by domain (`loginTitle`, `gameOver`, `settingsTitle`).

**Example:**
```dart
Text(AppStrings.loginTitle);
InputDecoration(hintText: AppStrings.loginEmailHint);
Text(AppStrings.gameOver);
```

---

## ğŸ“ Spacing / Layout

* **No magic numbers** for padding/margins/gapsâ€”use `AppSpacing`, `Gaps`, `Insets`, `NumSpaceExtension`.
* Keep visual rhythm consistent (vertical rhythm via `Gaps.h*`, horizontal via `Gaps.w*`).

```dart
Padding(
  padding: Insets.allMd,
  child: Row(children: [const Icon(Icons.star), Gaps.wMd, const Expanded(child: Text('Item'))]),
);
```

---

## ğŸ—‚ Assets Folder Structure

```
assets/
â”œâ”€â”€ fonts/
â”œâ”€â”€ icons/            # SVG (preferred)
â””â”€â”€ images/
```

> Register folders in **pubspec.yaml** and keep all lookups via `AppIcons` / `AppImages`.

```yaml
flutter:
  uses-material-design: true
  assets:
    - assets/icons/
    - assets/images/
```

---

## ğŸš€ App Entry

* `main.dart` â†’ only `runApp(const App())`.
* `app.dart` â†’ `MultiProvider`, `MaterialApp`, `initialRoute`, `routes: AppRoutes.routes`, `theme: appTheme`.

---

## ğŸ“¦ Recommended Packages

Keep dependencies up to date. Use listed packages for their specific concerns:

```yaml
dependencies:
  # Local Data
  drift: ^2.28.1
  sqlite3_flutter_libs: ^0.5.20
  path_provider: ^2.1.5
  shared_preferences: ^2.3.2

  # UI / Graphics
  flutter_svg: ^2.0.10+1
  animated_bottom_navigation_bar: ^1.4.0
  table_calendar: ^3.2.0
  fl_chart: ^1.0.2
  percent_indicator: ^4.2.3
  flutter_datetime_picker_plus: ^2.1.1
  flutter_colorpicker: ^1.0.3
  data_table_2: ^2.6.0

  # Networking
  dio: ^5.7.0
  retrofit: ^4.1.1
  json_annotation: ^4.9.0

  # AI
  google_generative_ai: ^0.4.5

  # File / Media
  file_picker: ^8.0.3
  image_picker: ^1.1.2
  camera: ^0.11.0+2

  # Voice
  speech_to_text: ^6.6.0

  # Architecture
  provider: ^6.1.1

dev_dependencies:
  very_good_analysis: ^5.1.0
  build_runner: ^2.4.11
  json_serializable: ^6.8.0
```

> Use `flutter_svg` for all vector icons. `drift` + `sqlite3_flutter_libs` for local DB. `provider` for state management.

---

## âœ… Restrictions (LLM Guardrails)

* Repositories abstract data sources (API, DB, cache). They do not contain business logic â€” only data fetching and mapping.
* Generate **complete, runnable code** (with imports) â€” no TODOs/pseudocode.
* State management: **Provider + ChangeNotifier** (business logic only in providers).
* Navigation: use `AppRoutes.routes` (or project router per PRD).
* Spacing/tokens: **no inline numbers** â€” use `AppSpacing/Gaps/Insets/NumSpaceExtension`, `AppRadius`, `AppDurations`, `Sizes`.
* Resources: use **only** `AppImages` / `AppIcons` (no raw asset strings).
* Theme: use types from `app_theme.dart` / `app_colors.dart` / `app_fonts.dart`.
* If a UI element repeats â‰¥ 2 times â€” extract a private widget in the same file.

---